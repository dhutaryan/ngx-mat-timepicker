import{a as H,b as Y,c as S,d as X,e as x,f as F,g as xt,h as bt}from"./chunk-6K3SEA2M.js";import"./chunk-XS6ISNC7.js";import{a as ft,b as $}from"./chunk-B72ENZ7G.js";import"./chunk-PQJID6XK.js";import{a as wt}from"./chunk-FYZUCTOS.js";import{A as vt,e as D,t as mt,u as yt,y as gt}from"./chunk-FTYTOPXI.js";import"./chunk-C243E7A6.js";import{F as M,Fa as R,G as ut,Ia as st,Ma as ot,Na as it,Sa as j,Ta as q,b as Jt,c as Zt,db as kt,h as y,i as pt,k as ht,mb as G}from"./chunk-LKEEL6EA.js";import{h as dt,j as z}from"./chunk-TWZW5B45.js";var Q={normal:te,vee:ee,undirected:re};function St(r){Q=r}function te(r,e,t,n){var a=r.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),s=a.append("path").attr("d","M 0 0 L 10 5 L 0 10 z").style("stroke-width",1).style("stroke-dasharray","1,0");S(s,t[n+"Style"]),t[n+"Class"]&&s.attr("class",t[n+"Class"])}function ee(r,e,t,n){var a=r.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),s=a.append("path").attr("d","M 0 0 L 10 5 L 0 10 L 4 5 z").style("stroke-width",1).style("stroke-dasharray","1,0");S(s,t[n+"Style"]),t[n+"Class"]&&s.attr("class",t[n+"Class"])}function re(r,e,t,n){var a=r.append("marker").attr("id",e).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto"),s=a.append("path").attr("d","M 0 5 L 10 5").style("stroke-width",1).style("stroke-dasharray","1,0");S(s,t[n+"Style"]),t[n+"Class"]&&s.attr("class",t[n+"Class"])}function Lt(r,e){var t=r;return t.node().appendChild(e.label),S(t,e.labelStyle),t}function Et(r,e){for(var t=r.append("text"),n=ae(e.label).split(`
`),a=0;a<n.length;a++)t.append("tspan").attr("xml:space","preserve").attr("dy","1em").attr("x","1").text(n[a]);return S(t,e.labelStyle),t}function ae(r){for(var e="",t=!1,n,a=0;a<r.length;++a)n=r[a],t?(n==="n"?e+=`
`:e+=n,t=!1):n==="\\"?t=!0:e+=n;return e}function O(r,e,t){var n=e.label,a=r.append("g");e.labelType==="svg"?Lt(a,e):typeof n!="string"||e.labelType==="html"?F(a,e):Et(a,e);var s=a.node().getBBox(),o;switch(t){case"top":o=-e.height/2;break;case"bottom":o=e.height/2-s.height;break;default:o=-s.height/2}return a.attr("transform","translate("+-s.width/2+","+o+")"),a}var K=function(r,e){var t=e.nodes().filter(function(s){return H(e,s)}),n=r.selectAll("g.cluster").data(t,function(s){return s});x(n.exit(),e).style("opacity",0).remove();var a=n.enter().append("g").attr("class","cluster").attr("id",function(s){var o=e.node(s);return o.id}).style("opacity",0).each(function(s){var o=e.node(s),i=y(this);y(this).append("rect");var c=i.append("g").attr("class","label");O(c,o,o.clusterLabelPos)});return n=n.merge(a),n=x(n,e).style("opacity",1),n.selectAll("rect").each(function(s){var o=e.node(s),i=y(this);S(i,o.style)}),n};function Tt(r){K=r}var J=function(r,e){var t=r.selectAll("g.edgeLabel").data(e.edges(),function(a){return Y(a)}).classed("update",!0);t.exit().remove(),t.enter().append("g").classed("edgeLabel",!0).style("opacity",0),t=r.selectAll("g.edgeLabel"),t.each(function(a){var s=y(this);s.select(".label").remove();var o=e.edge(a),i=O(s,e.edge(a),0).classed("label",!0),c=i.node().getBBox();o.labelId&&i.attr("id",o.labelId),Object.prototype.hasOwnProperty.call(o,"width")||(o.width=c.width),Object.prototype.hasOwnProperty.call(o,"height")||(o.height=c.height)});var n;return t.exit?n=t.exit():n=t.selectAll(null),x(n,e).style("opacity",0).remove(),t};function _t(r){J=r}function lt(r,e){return r.intersect(e)}var Z=function(r,e,t){var n=r.selectAll("g.edgePath").data(e.edges(),function(o){return Y(o)}).classed("update",!0),a=le(n,e);ce(n,e);var s=n.merge!==void 0?n.merge(a):n;return x(s,e).style("opacity",1),s.each(function(o){var i=y(this),c=e.edge(o);c.elem=this,c.id&&i.attr("id",c.id),X(i,c.class,(i.classed("update")?"update ":"")+"edgePath")}),s.selectAll("path.path").each(function(o){var i=e.edge(o);i.arrowheadId=gt("arrowhead");var c=y(this).attr("marker-end",function(){return"url("+se(location.href,i.arrowheadId)+")"}).style("fill","none");x(c,e).attr("d",function(d){return oe(e,d)}),S(c,i.style)}),s.selectAll("defs *").remove(),s.selectAll("defs").each(function(o){var i=e.edge(o),c=t[i.arrowhead];c(y(this),i.arrowheadId,i,"arrowhead")}),s};function Nt(r){Z=r}function se(r,e){var t=r.split("#")[0];return t+"#"+e}function oe(r,e){var t=r.edge(e),n=r.node(e.v),a=r.node(e.w),s=t.points.slice(1,t.points.length-1);return s.unshift(lt(n,s[0])),s.push(lt(a,s[s.length-1])),Ct(t,s)}function Ct(r,e){var t=(ut||ht.line)().x(function(n){return n.x}).y(function(n){return n.y});return(t.curve||t.interpolate)(r.curve),t(e)}function ie(r){var e=r.getBBox(),t=r.ownerSVGElement.getScreenCTM().inverse().multiply(r.getScreenCTM()).translate(e.width/2,e.height/2);return{x:t.e,y:t.f}}function le(r,e){var t=r.enter().append("g").attr("class","edgePath").style("opacity",0);return t.append("path").attr("class","path").attr("d",function(n){var a=e.edge(n),s=e.node(n.v).elem,o=yt(a.points.length).map(function(){return ie(s)});return Ct(a,o)}),t.append("defs"),t}function ce(r,e){var t=r.exit();x(t,e).style("opacity",0).remove()}var tt=function(r,e,t){var n=e.nodes().filter(function(o){return!H(e,o)}),a=r.selectAll("g.node").data(n,function(o){return o}).classed("update",!0);a.exit().remove(),a.enter().append("g").attr("class","node").style("opacity",0),a=r.selectAll("g.node"),a.each(function(o){var i=e.node(o),c=y(this);X(c,i.class,(c.classed("update")?"update ":"")+"node"),c.select("g.label").remove();var d=c.append("g").attr("class","label"),l=O(d,i),m=t[i.shape],p=mt(l.node().getBBox(),"width","height");i.elem=this,i.id&&c.attr("id",i.id),i.labelId&&d.attr("id",i.labelId),Object.prototype.hasOwnProperty.call(i,"width")&&(p.width=i.width),Object.prototype.hasOwnProperty.call(i,"height")&&(p.height=i.height),p.width+=i.paddingLeft+i.paddingRight,p.height+=i.paddingTop+i.paddingBottom,d.attr("transform","translate("+(i.paddingLeft-i.paddingRight)/2+","+(i.paddingTop-i.paddingBottom)/2+")");var h=y(this);h.select(".label-container").remove();var f=m(h,p,i).classed("label-container",!0);S(f,i.style);var v=f.node().getBBox();i.width=v.width,i.height=v.height});var s;return a.exit?s=a.exit():s=a.selectAll(null),x(s,e).style("opacity",0).remove(),a};function At(r){tt=r}function Pt(r,e){var t=r.filter(function(){return!y(this).classed("update")});function n(a){var s=e.node(a);return"translate("+s.x+","+s.y+")"}t.attr("transform",n),x(r,e).style("opacity",1).attr("transform",n),x(t.selectAll("rect"),e).attr("width",function(a){return e.node(a).width}).attr("height",function(a){return e.node(a).height}).attr("x",function(a){var s=e.node(a);return-s.width/2}).attr("y",function(a){var s=e.node(a);return-s.height/2})}function It(r,e){var t=r.filter(function(){return!y(this).classed("update")});function n(a){var s=e.edge(a);return Object.prototype.hasOwnProperty.call(s,"x")?"translate("+s.x+","+s.y+")":""}t.attr("transform",n),x(r,e).style("opacity",1).attr("transform",n)}function Bt(r,e){var t=r.filter(function(){return!y(this).classed("update")});function n(a){var s=e.node(a);return"translate("+s.x+","+s.y+")"}t.attr("transform",n),x(r,e).style("opacity",1).attr("transform",n)}function et(r,e,t,n){var a=r.x,s=r.y,o=a-n.x,i=s-n.y,c=Math.sqrt(e*e*i*i+t*t*o*o),d=Math.abs(e*t*o/c);n.x<a&&(d=-d);var l=Math.abs(e*t*i/c);return n.y<s&&(l=-l),{x:a+d,y:s+l}}function Mt(r,e,t){return et(r,e,e,t)}function Rt(r,e,t,n){var a,s,o,i,c,d,l,m,p,h,f,v,u,g,L;if(a=e.y-r.y,o=r.x-e.x,c=e.x*r.y-r.x*e.y,p=a*t.x+o*t.y+c,h=a*n.x+o*n.y+c,!(p!==0&&h!==0&&Dt(p,h))&&(s=n.y-t.y,i=t.x-n.x,d=n.x*t.y-t.x*n.y,l=s*r.x+i*r.y+d,m=s*e.x+i*e.y+d,!(l!==0&&m!==0&&Dt(l,m))&&(f=a*i-s*o,f!==0)))return v=Math.abs(f/2),u=o*d-i*c,g=u<0?(u-v)/f:(u+v)/f,u=s*c-a*d,L=u<0?(u-v)/f:(u+v)/f,{x:g,y:L}}function Dt(r,e){return r*e>0}function T(r,e,t){var n=r.x,a=r.y,s=[],o=Number.POSITIVE_INFINITY,i=Number.POSITIVE_INFINITY;e.forEach(function(f){o=Math.min(o,f.x),i=Math.min(i,f.y)});for(var c=n-r.width/2-o,d=a-r.height/2-i,l=0;l<e.length;l++){var m=e[l],p=e[l<e.length-1?l+1:0],h=Rt(r,t,{x:c+m.x,y:d+m.y},{x:c+p.x,y:d+p.y});h&&s.push(h)}return s.length?(s.length>1&&s.sort(function(f,v){var u=f.x-t.x,g=f.y-t.y,L=Math.sqrt(u*u+g*g),I=v.x-t.x,_=v.y-t.y,at=Math.sqrt(I*I+_*_);return L<at?-1:L===at?0:1}),s[0]):(console.log("NO INTERSECTION FOUND, RETURN NODE CENTER",r),r)}function U(r,e){var t=r.x,n=r.y,a=e.x-t,s=e.y-n,o=r.width/2,i=r.height/2,c,d;return Math.abs(s)*o>Math.abs(a)*i?(s<0&&(i=-i),c=s===0?0:i*a/s,d=i):(a<0&&(o=-o),c=o,d=a===0?0:o*s/a),{x:t+c,y:n+d}}var rt={rect:fe,ellipse:me,circle:ye,diamond:ge};function Gt(r){rt=r}function fe(r,e,t){var n=r.insert("rect",":first-child").attr("rx",t.rx).attr("ry",t.ry).attr("x",-e.width/2).attr("y",-e.height/2).attr("width",e.width).attr("height",e.height);return t.intersect=function(a){return U(t,a)},n}function me(r,e,t){var n=e.width/2,a=e.height/2,s=r.insert("ellipse",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("rx",n).attr("ry",a);return t.intersect=function(o){return et(t,n,a,o)},s}function ye(r,e,t){var n=Math.max(e.width,e.height)/2,a=r.insert("circle",":first-child").attr("x",-e.width/2).attr("y",-e.height/2).attr("r",n);return t.intersect=function(s){return Mt(t,n,s)},a}function ge(r,e,t){var n=e.width*Math.SQRT2/2,a=e.height*Math.SQRT2/2,s=[{x:0,y:-a},{x:-n,y:0},{x:0,y:a},{x:n,y:0}],o=r.insert("polygon",":first-child").attr("points",s.map(function(i){return i.x+","+i.y}).join(" "));return t.intersect=function(i){return T(t,s,i)},o}function ct(){var r=function(e,t){xe(t);var n=W(e,"output"),a=W(n,"clusters"),s=W(n,"edgePaths"),o=J(W(n,"edgeLabels"),t),i=tt(W(n,"nodes"),t,rt);wt(t),Bt(i,t),It(o,t),Z(s,t,Q);var c=K(a,t);Pt(c,t),be(t)};return r.createNodes=function(e){return arguments.length?(At(e),r):tt},r.createClusters=function(e){return arguments.length?(Tt(e),r):K},r.createEdgeLabels=function(e){return arguments.length?(_t(e),r):J},r.createEdgePaths=function(e){return arguments.length?(Nt(e),r):Z},r.shapes=function(e){return arguments.length?(Gt(e),r):rt},r.arrows=function(e){return arguments.length?(St(e),r):Q},r}var ve={paddingLeft:10,paddingRight:10,paddingTop:10,paddingBottom:10,rx:0,ry:0,shape:"rect"},we={arrowhead:"normal",curve:M};function xe(r){r.nodes().forEach(e=>{let t=r.node(e);!Object.prototype.hasOwnProperty.call(t,"label")&&!r.children(e).length&&(t.label=e),Object.prototype.hasOwnProperty.call(t,"paddingX")&&D(t,{paddingLeft:t.paddingX,paddingRight:t.paddingX}),Object.prototype.hasOwnProperty.call(t,"paddingY")&&D(t,{paddingTop:t.paddingY,paddingBottom:t.paddingY}),Object.prototype.hasOwnProperty.call(t,"padding")&&D(t,{paddingLeft:t.padding,paddingRight:t.padding,paddingTop:t.padding,paddingBottom:t.padding}),D(t,ve),["paddingLeft","paddingRight","paddingTop","paddingBottom"].forEach(n=>{t[n]=Number(t[n])}),Object.prototype.hasOwnProperty.call(t,"width")&&(t._prevWidth=t.width),Object.prototype.hasOwnProperty.call(t,"height")&&(t._prevHeight=t.height)}),r.edges().forEach(function(e){var t=r.edge(e);Object.prototype.hasOwnProperty.call(t,"label")||(t.label=""),D(t,we)})}function be(r){r.nodes().forEach(e=>{var t=r.node(e);Object.prototype.hasOwnProperty.call(t,"_prevWidth")?t.width=t._prevWidth:delete t.width,Object.prototype.hasOwnProperty.call(t,"_prevHeight")?t.height=t._prevHeight:delete t.height,delete t._prevWidth,delete t._prevHeight})}function W(r,e){var t=r.select("g."+e);return t.empty()&&(t=r.append("g").attr("class",e)),t}var Cr=dt(Jt(),1),Ar=dt(Zt(),1);function Ot(r,e,t){let n=e.width,a=e.height,s=(n+a)*.9,o=[{x:s/2,y:0},{x:s,y:-s/2},{x:s/2,y:-s},{x:0,y:-s/2}],i=C(r,s,s,o);return t.intersect=function(c){return T(t,o,c)},i}function Ut(r,e,t){let a=e.height,s=a/4,o=e.width+2*s,i=[{x:s,y:0},{x:o-s,y:0},{x:o,y:-a/2},{x:o-s,y:-a},{x:s,y:-a},{x:0,y:-a/2}],c=C(r,o,a,i);return t.intersect=function(d){return T(t,i,d)},c}function Wt(r,e,t){let n=e.width,a=e.height,s=[{x:-a/2,y:0},{x:n,y:0},{x:n,y:-a},{x:-a/2,y:-a},{x:0,y:-a/2}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function Vt(r,e,t){let n=e.width,a=e.height,s=[{x:-2*a/6,y:0},{x:n-a/6,y:0},{x:n+2*a/6,y:-a},{x:a/6,y:-a}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function zt(r,e,t){let n=e.width,a=e.height,s=[{x:2*a/6,y:0},{x:n+a/6,y:0},{x:n-2*a/6,y:-a},{x:-a/6,y:-a}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function $t(r,e,t){let n=e.width,a=e.height,s=[{x:-2*a/6,y:0},{x:n+2*a/6,y:0},{x:n-a/6,y:-a},{x:a/6,y:-a}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function Ht(r,e,t){let n=e.width,a=e.height,s=[{x:a/6,y:0},{x:n-a/6,y:0},{x:n+2*a/6,y:-a},{x:-2*a/6,y:-a}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function Yt(r,e,t){let n=e.width,a=e.height,s=[{x:0,y:0},{x:n+a/2,y:0},{x:n,y:-a/2},{x:n+a/2,y:-a},{x:0,y:-a}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function Xt(r,e,t){let n=e.height,a=e.width+n/4,s=r.insert("rect",":first-child").attr("rx",n/2).attr("ry",n/2).attr("x",-a/2).attr("y",-n/2).attr("width",a).attr("height",n);return t.intersect=function(o){return U(t,o)},s}function Ft(r,e,t){let n=e.width,a=e.height,s=[{x:0,y:0},{x:n,y:0},{x:n,y:-a},{x:0,y:-a},{x:0,y:0},{x:-8,y:0},{x:n+8,y:0},{x:n+8,y:-a},{x:-8,y:-a},{x:-8,y:0}],o=C(r,n,a,s);return t.intersect=function(i){return T(t,s,i)},o}function jt(r,e,t){let n=e.width,a=n/2,s=a/(2.5+n/50),o=e.height+s,i="M 0,"+s+" a "+a+","+s+" 0,0,0 "+n+" 0 a "+a+","+s+" 0,0,0 "+-n+" 0 l 0,"+o+" a "+a+","+s+" 0,0,0 "+n+" 0 l 0,"+-o,c=r.attr("label-offset-y",s).insert("path",":first-child").attr("d",i).attr("transform","translate("+-n/2+","+-(o/2+s)+")");return t.intersect=function(d){let l=U(t,d),m=l.x-t.x;if(a!=0&&(Math.abs(m)<t.width/2||Math.abs(m)==t.width/2&&Math.abs(l.y-t.y)>t.height/2-s)){let p=s*s*(1-m*m/(a*a));p!=0&&(p=Math.sqrt(p)),p=s-p,d.y-t.y>0&&(p=-p),l.y+=p}return l},c}function Le(r){r.shapes().question=Ot,r.shapes().hexagon=Ut,r.shapes().stadium=Xt,r.shapes().subroutine=Ft,r.shapes().cylinder=jt,r.shapes().rect_left_inv_arrow=Wt,r.shapes().lean_right=Vt,r.shapes().lean_left=zt,r.shapes().trapezoid=$t,r.shapes().inv_trapezoid=Ht,r.shapes().rect_right_inv_arrow=Yt}function Ee(r){r({question:Ot}),r({hexagon:Ut}),r({stadium:Xt}),r({subroutine:Ft}),r({cylinder:jt}),r({rect_left_inv_arrow:Wt}),r({lean_right:Vt}),r({lean_left:zt}),r({trapezoid:$t}),r({inv_trapezoid:Ht}),r({rect_right_inv_arrow:Yt})}function C(r,e,t,n){return r.insert("polygon",":first-child").attr("points",n.map(function(a){return a.x+","+a.y}).join(" ")).attr("transform","translate("+-e/2+","+t/2+")")}var Te={addToRender:Le,addToRenderV2:Ee},qt={},_e=function(r){let e=Object.keys(r);for(let t of e)qt[t]=r[t]},Qt=function(r,e,t,n,a,s){return z(this,null,function*(){let o=n?n.select(`[id="${t}"]`):y(`[id="${t}"]`),i=a||document,c=Object.keys(r);for(let d of c){let l=r[d],m="default";l.classes.length>0&&(m=l.classes.join(" "));let p=q(l.styles),h=l.text!==void 0?l.text:l.id,f;if(st(G().flowchart.htmlLabels)){let g={label:yield ot(h.replace(/fa[blrs]?:fa-[\w-]+/g,L=>`<i class='${L.replace(":"," ")}'></i>`),G())};f=F(o,g).node(),f.parentNode.removeChild(f)}else{let g=i.createElementNS("http://www.w3.org/2000/svg","text");g.setAttribute("style",p.labelStyle.replace("color:","fill:"));let L=h.split(it.lineBreakRegex);for(let I of L){let _=i.createElementNS("http://www.w3.org/2000/svg","tspan");_.setAttributeNS("http://www.w3.org/XML/1998/namespace","xml:space","preserve"),_.setAttribute("dy","1em"),_.setAttribute("x","1"),_.textContent=I,g.appendChild(_)}f=g}let v=0,u="";switch(l.type){case"round":v=5,u="rect";break;case"square":u="rect";break;case"diamond":u="question";break;case"hexagon":u="hexagon";break;case"odd":u="rect_left_inv_arrow";break;case"lean_right":u="lean_right";break;case"lean_left":u="lean_left";break;case"trapezoid":u="trapezoid";break;case"inv_trapezoid":u="inv_trapezoid";break;case"odd_right":u="rect_left_inv_arrow";break;case"circle":u="circle";break;case"ellipse":u="ellipse";break;case"stadium":u="stadium";break;case"subroutine":u="subroutine";break;case"cylinder":u="cylinder";break;case"group":u="rect";break;default:u="rect"}R.warn("Adding node",l.id,l.domId),e.setNode(s.db.lookUpDomId(l.id),{labelType:"svg",labelStyle:p.labelStyle,shape:u,label:f,rx:v,ry:v,class:m,style:p.style,id:s.db.lookUpDomId(l.id)})}})},Kt=function(r,e,t){return z(this,null,function*(){let n=0,a,s;if(r.defaultStyle!==void 0){let o=q(r.defaultStyle);a=o.style,s=o.labelStyle}for(let o of r){n++;let i="L-"+o.start+"-"+o.end,c="LS-"+o.start,d="LE-"+o.end,l={};o.type==="arrow_open"?l.arrowhead="none":l.arrowhead="normal";let m="",p="";if(o.style!==void 0){let h=q(o.style);m=h.style,p=h.labelStyle}else switch(o.stroke){case"normal":m="fill:none",a!==void 0&&(m=a),s!==void 0&&(p=s);break;case"dotted":m="fill:none;stroke-width:2px;stroke-dasharray:3;";break;case"thick":m=" stroke-width: 3.5px;fill:none";break}l.style=m,l.labelStyle=p,o.interpolate!==void 0?l.curve=j(o.interpolate,M):r.defaultInterpolate!==void 0?l.curve=j(r.defaultInterpolate,M):l.curve=j(qt.curve,M),o.text===void 0?o.style!==void 0&&(l.arrowheadStyle="fill: #333"):(l.arrowheadStyle="fill: #333",l.labelpos="c",st(G().flowchart.htmlLabels)?(l.labelType="html",l.label=`<span id="L-${i}" class="edgeLabel L-${c}' L-${d}" style="${l.labelStyle}">${yield ot(o.text.replace(/fa[blrs]?:fa-[\w-]+/g,h=>`<i class='${h.replace(":"," ")}'></i>`),G())}</span>`):(l.labelType="text",l.label=o.text.replace(it.lineBreakRegex,`
`),o.style===void 0&&(l.style=l.style||"stroke: #333; stroke-width: 1.5px;fill:none"),l.labelStyle=l.labelStyle.replace("color:","fill:"))),l.id=i,l.class=c+" "+d,l.minlen=o.length||1,e.setEdge(t.db.lookUpDomId(o.start),t.db.lookUpDomId(o.end),l,n)}})},Ne=function(r,e){return R.info("Extracting classes"),e.db.getClasses()},Ce=function(r,e,t,n){return z(this,null,function*(){R.info("Drawing flowchart");let{securityLevel:a,flowchart:s}=G(),o;a==="sandbox"&&(o=y("#i"+e));let i=a==="sandbox"?y(o.nodes()[0].contentDocument.body):y("body"),c=a==="sandbox"?o.nodes()[0].contentDocument:document,d=n.db.getDirection();d===void 0&&(d="TD");let l=s.nodeSpacing||50,m=s.rankSpacing||50,p=new vt({multigraph:!0,compound:!0}).setGraph({rankdir:d,nodesep:l,ranksep:m,marginx:8,marginy:8}).setDefaultEdgeLabel(function(){return{}}),h,f=n.db.getSubGraphs();for(let w=f.length-1;w>=0;w--)h=f[w],n.db.addVertex(h.id,h.title,"group",void 0,h.classes);let v=n.db.getVertices();R.warn("Get vertices",v);let u=n.db.getEdges(),g=0;for(g=f.length-1;g>=0;g--){h=f[g],pt("cluster").append("text");for(let w=0;w<h.nodes.length;w++)R.warn("Setting subgraph",h.nodes[w],n.db.lookUpDomId(h.nodes[w]),n.db.lookUpDomId(h.id)),p.setParent(n.db.lookUpDomId(h.nodes[w]),n.db.lookUpDomId(h.id))}yield Qt(v,p,e,i,c,n),yield Kt(u,p,n);let L=new ct;Te.addToRender(L),L.arrows().none=function(k,E,b,B){let A=k.append("marker").attr("id",E).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 0 0 L 0 0 z");S(A,b[B+"Style"])},L.arrows().normal=function(k,E){k.append("marker").attr("id",E).attr("viewBox","0 0 10 10").attr("refX",9).attr("refY",5).attr("markerUnits","strokeWidth").attr("markerWidth",8).attr("markerHeight",6).attr("orient","auto").append("path").attr("d","M 0 0 L 10 5 L 0 10 z").attr("class","arrowheadPath").style("stroke-width",1).style("stroke-dasharray","1,0")};let I=i.select(`[id="${e}"]`),_=i.select("#"+e+" g");for(L(_,p),_.selectAll("g.node").attr("title",function(){return n.db.getTooltip(this.id)}),n.db.indexNodes("subGraph"+g),g=0;g<f.length;g++)if(h=f[g],h.title!=="undefined"){let w=c.querySelectorAll("#"+e+' [id="'+n.db.lookUpDomId(h.id)+'"] rect'),k=c.querySelectorAll("#"+e+' [id="'+n.db.lookUpDomId(h.id)+'"]'),E=w[0].x.baseVal.value,b=w[0].y.baseVal.value,B=w[0].width.baseVal.value,A=y(k[0]).select(".label");A.attr("transform",`translate(${E+B/2}, ${b+14})`),A.attr("id",e+"Text");for(let nt=0;nt<h.classes.length;nt++)k[0].classList.add(h.classes[nt])}if(!s.htmlLabels){let w=c.querySelectorAll('[id="'+e+'"] .edgeLabel .label');for(let k of w){let E=k.getBBox(),b=c.createElementNS("http://www.w3.org/2000/svg","rect");b.setAttribute("rx",0),b.setAttribute("ry",0),b.setAttribute("width",E.width),b.setAttribute("height",E.height),k.insertBefore(b,k.firstChild)}}kt(p,I,s.diagramPadding,s.useMaxWidth),Object.keys(v).forEach(function(w){let k=v[w];if(k.link){let E=i.select("#"+e+' [id="'+n.db.lookUpDomId(w)+'"]');if(E){let b=c.createElementNS("http://www.w3.org/2000/svg","a");b.setAttributeNS("http://www.w3.org/2000/svg","class",k.classes.join(" ")),b.setAttributeNS("http://www.w3.org/2000/svg","href",k.link),b.setAttributeNS("http://www.w3.org/2000/svg","rel","noopener"),a==="sandbox"?b.setAttributeNS("http://www.w3.org/2000/svg","target","_top"):k.linkTarget&&b.setAttributeNS("http://www.w3.org/2000/svg","target",k.linkTarget);let B=E.insert(function(){return b},":first-child"),V=E.select(".label-container");V&&B.append(function(){return V.node()});let A=E.select(".label");A&&B.append(function(){return A.node()})}}})})},Ae={setConf:_e,addVertices:Qt,addEdges:Kt,getClasses:Ne,draw:Ce},Mr={parser:ft,db:$,renderer:xt,styles:bt,init:r=>{r.flowchart||(r.flowchart={}),r.flowchart.arrowMarkerAbsolute=r.arrowMarkerAbsolute,Ae.setConf(r.flowchart),$.clear(),$.setGen("gen-1")}};export{Mr as diagram};
